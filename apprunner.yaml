version: 1.0
runtime: nodejs22
build:
  commands:
    pre-build:
      - npm ci
    build:
      - npx nest build
    post-build:
      - npm prune --production
run:
  command: npm run start:prod
  network:
    port: 8080
  env:
    - name: NODE_ENV
      value: "production"
    - name: PORT
      value: "8080"
    - name: STORAGE_PROVIDER
      value: "cloudinary"
    # Add these sensitive variables via AWS Console, not here:
    # DATABASE_URL, JWT_SECRET, CLOUDINARY_CLOUD_NAME, CLOUDINARY_API_KEY,
    # CLOUDINARY_API_SECRET, EMAIL_USER, EMAIL_PASSWORD, CONTACT_EMAIL,
    # ALLOWED_ORIGINS, FRONTEND_URL
